<VirtualHost *:80>
    ServerName your-domain.com  # 请替换为您的域名或IP

    DocumentRoot "/usr/local/www/drawfun"

    # React前端应用 - 根目录
    <Directory "/usr/local/www/drawfun">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted

        # 支持React Router - 重写规则
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>

    # 后端API接口 - 使用PHP-FPM
    Alias /api "/usr/local/www/drawfun/api"
    <Directory "/usr/local/www/drawfun/api">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted

        # PHP-FPM配置
        <FilesMatch \.php$>
            SetHandler "proxy:unix:/var/run/php-fpm.sock|fcgi://localhost"
        </FilesMatch>

        # 如果有路由重写需求（如Laravel等框架）
        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^(.*)$ index.php [QSA,L]
    </Directory>

    # phpMyAdmin - 使用PHP-FPM
    Alias /pa "/usr/local/www/phpMyAdmin"
    <Directory "/usr/local/www/phpMyAdmin">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted

        # PHP-FPM配置
        <FilesMatch \.php$>
            SetHandler "proxy:unix:/var/run/php-fpm.sock|fcgi://localhost"
        </FilesMatch>

        # 安全设置 - 限制访问IP（可选）
        # Require ip 192.168.1.0/24
        # Require local
    </Directory>

    # 静态资源缓存
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType text/css "access plus 1 year"
        ExpiresByType application/javascript "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/svg+xml "access plus 1 year"
        ExpiresByType image/x-icon "access plus 1 year"
    </IfModule>

    # 错误日志
    ErrorLog "/var/log/apache2/your-domain-error_log"
    CustomLog "/var/log/apache2/your-domain-access_log" common
</VirtualHost>
